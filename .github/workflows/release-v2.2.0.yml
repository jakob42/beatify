name: Release v2.2.0

on:
  schedule:
    # Friday January 30, 2026 at 12:00 UTC
    - cron: '0 12 30 1 *'
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run (no actual release)'
        required: false
        default: false
        type: boolean

jobs:
  release:
    runs-on: ubuntu-latest
    # Only run in 2026 (prevents re-runs in future years)
    if: github.event_name == 'workflow_dispatch' || (github.event_name == 'schedule' && contains('2026', github.event.repository.updated_at))

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check if release already exists
        id: check
        run: |
          if gh release view v2.2.0 &>/dev/null; then
            echo "exists=true" >> $GITHUB_OUTPUT
            echo "::warning::Release v2.2.0 already exists, skipping"
          else
            echo "exists=false" >> $GITHUB_OUTPUT
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Release
        if: steps.check.outputs.exists == 'false' && !inputs.dry_run
        run: |
          gh release create v2.2.0 \
            --title "v2.2.0 â€” YouTube Music & Playlist Requests" \
            --notes "$(cat <<'EOF'
          # Beatify v2.2.0 â€” YouTube Music & Playlist Requests

          **Release Date:** January 2026

          Beatify expands beyond Spotify with YouTube Music support, adds custom playlist requests, and drops 100 classic 80s bangers.

          ---

          ## ðŸŽµ YouTube Music Provider Support

          Beatify now supports YouTube Music as a music service provider alongside Spotify and Apple Music! Select YouTube Music in the admin settings to use it as your music service. Playlists now include YouTube Music URIs for seamless playback through the Music Assistant integration. The admin UI features a new YouTube Music chip in the provider selector.

          Four playlists are fully equipped with YouTube Music URIs: 80er Hits (99 of 100 songs), Greatest Hits of All Time (100 songs), Eurovision Winners (67 of 72 songs), and Schlager Klassiker (60 songs).

          ---

          ## ðŸ“ Custom Playlist Requests

          Users can now request custom Spotify playlists directly from the Beatify interface! Simply submit a playlist name and Spotify URL through the new request form. All requests are stored on the Home Assistant backend and visible to admins in the admin panel for review and approval.

          ---

          ## ðŸŽ¹ New Playlist: 80er Hits

          100 classic hits from the decade of synths, big hair, and MTV. Features bangers from Michael Jackson, Prince, Madonna, Depeche Mode, A-ha, Duran Duran, Cyndi Lauper, The Police, and many more iconic 80s artists.

          ---

          **Full Changelog:** https://github.com/mholzi/beatify/compare/v2.1.0...v2.2.0

          *Your speakers, your music service, your party!* ðŸŽ‰
          EOF
          )"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Dry run output
        if: inputs.dry_run
        run: |
          echo "ðŸ§ª DRY RUN - Would create release v2.2.0"
          echo "Title: v2.2.0 â€” YouTube Music & Playlist Requests"
